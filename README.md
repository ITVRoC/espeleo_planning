# Espeleorobo planning

This repository contains codes for generating and/or publishing reference paths for the espeleorobo


## Scripts included on this package:
- `example_trajectories.py`: Generates a example path to be followed by the robot;
- `dijkstra_trajectories.py`: Reads from a txt file a trajectory generated by a Dijkstra Algorithm. The trajectories are stored on the folder txt_trajectories.

## Txt format:
The trajectories written on the files `trraj_N.txt` (inside txt_trajectories) must have the number of sampled pioints on the first line. Each of the following lines corresponds to the coordinates `x`, `y` and `z` separated by a `\t`.


## How to interact - example_trajectories.py

This code implements some example trajectories to be published.

**Topics:**
- `/espeleo/traj_points`  (message type: `espeleo_control/Path`): Publish to this topic a sequence of points representing a path, if it is closed or not, and two parameters to interpolate points and filter.

- `/visualization_marker_array`  (message type: `visualization_msgs/MarkerArray`): Use this topic on rviz to visualize the last published trajectory. This message is published only once, thus, rviz should be ready to receive it when the node is run.


**Input parameters:**

There is a file `planning_params.yaml` that contain some parameters for this package. They are listed below.

Parameters for the example trajectories:
- `N_curve`: number of example curve to be generated, from 1 to 3;
- `N_points`: number of points of the curve to be sampled, 200 for example;
- `a`: stretch factor of the curve in the x direction;
- `b`: stretch factor of the curve in the y direction;
- `phi`: rotation of the curve around the z axis (in dregrees);
- `cx`: displacement in the x direction (meters);
- `cy`: displacement in the y direction (meters);
- `closed_path_flag` (`bool`): Flag to indicate if the path is closed or not;
- `insert_n_poins` (`int`): Number of points to be inserted in between each pair of points of the received trajectory;
- `filter_path_n_average` (`int`): Number of points to use in the average filter (it is forced to be an odd number) - if 0 the path is not filtered.

Parameters for choosing the Dijkstra trajectory:
- `dijkstra_traj_number`: Number of the Dijkstra trajectory.


**Usage:**

With roscore and CoppelaiaSim running (in this order), run the following launch flies (remember to select you scene):

`roslaunch espeleo_vrep_simulation espeleo_sim.launch`

Run the vector field controller:

`roslaunch espeleo_control vector_field.launch`

Now, the robot is already waiting for a trajectory to be followed. An example trajectory can be generated with the following command:

`roslaunch espeleo_planning launch_trajectory.launch`

In order to select an example trajectory or a trajectory generated by the Dijkstra the user must edit the launch file `launch_trajectory.launch`. One of the options is commented while the other is not
